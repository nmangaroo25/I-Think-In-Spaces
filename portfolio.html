<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Norris Mangaroo — Portfolio (Flipbook)</title>

  <style>
    :root{--bg:#0f1720;--card:#fff;--muted:#8892a6}
    html,body{height:100%;margin:0;font-family:Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:#fff}
    a.back {position:fixed;left:18px;top:18px;background:#fff;color:#111;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:600;z-index:9999}
    .topbar{position:fixed;right:18px;top:18px;display:flex;gap:8px;align-items:center;z-index:9999}
    .btn{background:#fff;color:#111;border:none;padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .pager{display:flex;gap:6px;align-items:center;background:rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px}
    #flipbook-wrap{height:100vh;display:flex;align-items:center;justify-content:center;padding:64px 24px;box-sizing:border-box}
    #flipbook{box-shadow:0 10px 30px rgba(2,6,23,0.7);background:transparent}
    .page{background:var(--card);overflow:hidden;display:flex;align-items:center;justify-content:center}
    #message{position:fixed;left:18px;bottom:18px;background:rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--muted);font-size:13px}
    @media (max-width:900px){
      .topbar{right:12px;gap:6px}
      a.back{left:12px;top:12px;padding:6px 10px}
    }
  </style>

  <!-- jQuery, pdf.js, turn.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turn.js@4/turn.min.js"></script>
</head>
<body>
  <a class="back" href="https://nmangaroo25.github.io/I-Think-In-Spaces/#home">← Back to Home</a>

  <div class="topbar" role="toolbar" aria-label="Flipbook controls">
    <div class="pager" title="Navigation">
      <button id="prev" class="btn" aria-label="Previous page">‹</button>
      <input id="pageNum" type="number" min="1" value="1" style="width:64px;padding:6px;border-radius:6px;border:none;font-weight:700" />
      <span id="pageTotal" style="color:var(--muted);font-weight:600;padding-left:6px">/ 0</span>
      <button id="next" class="btn" aria-label="Next page">›</button>
    </div>

    <div style="width:10px"></div>
    <div class="pager" title="View">
      <button id="zoomOut" class="btn" aria-label="Zoom out">−</button>
      <button id="zoomIn" class="btn" aria-label="Zoom in">＋</button>
    </div>

    <div style="width:10px"></div>
    <a id="download" class="btn" download>Download</a>
  </div>

  <div id="flipbook-wrap">
    <div id="flipbook" aria-live="polite" role="application" aria-label="Portfolio flipbook"></div>
  </div>

  <div id="message">If the flipbook doesn't load, check the browser console for errors. (Need help? paste any console errors here.)</div>

  <noscript>
    <div style="position:fixed;left:18px;bottom:64px;background:#fff;color:#111;padding:8px 12px;border-radius:8px">JavaScript required — <a href="Norris_Mangaroo_Arch_Portfolio.pdf" download>download the PDF</a></div>
  </noscript>

  <script>
    (function(){
      // Defensive checks for required libraries
      if (typeof pdfjsLib === 'undefined') {
        console.error('pdfjsLib not loaded');
        document.getElementById('message').textContent = 'Error: pdf.js library failed to load.';
        return;
      }
      if (typeof $ === 'undefined' || typeof $.fn.turn === 'undefined') {
        console.error('jQuery/turn.js not loaded');
        document.getElementById('message').textContent = 'Error: turn.js or jQuery failed to load.';
        return;
      }

      const url = "Norris_Mangaroo_Arch_Portfolio.pdf"; // EXACT filename — make sure this matches what's in your repo
      const flipbookEl = $('#flipbook');
      const pageCanvases = [];
      let currentZoom = 1;
      const baseRenderScale = 1.4;

      async function renderPdfToFlipbook() {
        try {
          const loadingTask = pdfjsLib.getDocument(url);
          const pdf = await loadingTask.promise;
          const total = pdf.numPages;
          $('#pageTotal').text('/ ' + total);
          $('#download').attr('href', url);

          for (let i = 1; i <= total; ++i) {
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: baseRenderScale });
            const canvas = document.createElement('canvas');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            canvas.style.maxWidth = '100%';
            canvas.style.height = 'auto';
            const ctx = canvas.getContext('2d');

            await page.render({ canvasContext: ctx, viewport: viewport }).promise;

            const pageDiv = document.createElement('div');
            pageDiv.className = 'page';
            pageDiv.appendChild(canvas);
            flipbookEl.append(pageDiv);
            pageCanvases.push(canvas);
          }

          const first = pageCanvases[0];
          const flipW = Math.min(window.innerWidth * 0.88, first.width * 2 * 0.9);
          const flipH = Math.min(window.innerHeight * 0.82, first.height * 0.95);

          flipbookEl.turn({
            width: flipW,
            height: flipH,
            autoCenter: true,
            display: 'double',
            elevation: 50,
            duration: 600,
          });

          $('#prev').on('click', () => flipbookEl.turn('previous'));
          $('#next').on('click', () => flipbookEl.turn('next'));
          $('#pageNum').attr('max', total);
          $('#pageNum').on('change', function(){ const p = Math.max(1, Math.min(total, Number(this.value) || 1)); flipbookEl.turn('page', p); });
          flipbookEl.bind('turned', function(e, page) { $('#pageNum').val(page); });

          function applyZoom() {
            pageCanvases.forEach(c => { c.style.transformOrigin = 'top left'; c.style.transform = 'scale(' + currentZoom + ')'; });
          }
          $('#zoomIn').on('click', function(){ currentZoom = Math.min(2.5, +(currentZoom + 0.15).toFixed(2)); applyZoom(); });
          $('#zoomOut').on('click', function(){ currentZoom = Math.max(0.6, +(currentZoom - 0.15).toFixed(2)); applyZoom(); });

          flipbookEl.turn('page', 1);
        } catch (err) {
          console.error('Flipbook error:', err);
          document.getElementById('message').textContent = 'Error loading flipbook — open browser console for details.';
        }
      }

      renderPdfToFlipbook();
    })();
  </script>
</body>
</html>
