<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Norris Mangaroo — Portfolio (Flipbook)</title>
  <style>
    :root{--bg:#0f1720;--card:#fff;--muted:#8892a6}
    html,body{height:100%;margin:0;font-family:Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:#fff}
    a.back {position:fixed;left:18px;top:18px;background:#fff;color:#111;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:600;z-index:9999}
    .topbar{position:fixed;right:18px;top:18px;display:flex;gap:8px;align-items:center;z-index:9999}
    .btn{background:#fff;color:#111;border:none;padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    .pager{display:flex;gap:6px;align-items:center;background:rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px}
    #flipbook-wrap{height:100vh;display:flex;align-items:center;justify-content:center;padding:64px 24px;box-sizing:border-box}
    #flipbook{box-shadow:0 10px 30px rgba(2,6,23,0.7);background:transparent}
    .page{background:var(--card);overflow:hidden;display:flex;align-items:center;justify-content:center}
    #message{position:fixed;left:18px;bottom:18px;background:rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <a class="back" href="https://nmangaroo25.github.io/I-Think-In-Spaces/#home">← Back to Home</a>

  <div class="topbar">
    <div class="pager">
      <button id="prev" class="btn">‹</button>
      <input id="pageNum" type="number" min="1" value="1" style="width:64px;padding:6px;border-radius:6px;border:none;font-weight:700" />
      <span id="pageTotal" style="color:var(--muted);font-weight:600;padding-left:6px">/ 0</span>
      <button id="next" class="btn">›</button>
    </div>
    <div style="width:10px"></div>
    <div class="pager">
      <button id="zoomOut" class="btn">−</button>
      <button id="zoomIn" class="btn">＋</button>
    </div>
  </div>

  <div id="flipbook-wrap">
    <div id="flipbook"></div>
  </div>

  <div id="message">Loading portfolio…</div>

  <!-- jQuery, Turn.js, PDF.js -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <script>
    (async function(){
      const url = "Norris_Mangaroo_Arch_Portfolio.pdf";
      const flipbookEl = $('#flipbook');
      let currentZoom = 1;

      try {
        const pdf = await pdfjsLib.getDocument(url).promise;
        const total = pdf.numPages;
        $('#pageTotal').text('/ ' + total);

        async function renderPage(num) {
          const page = await pdf.getPage(num);
          const viewport = page.getViewport({ scale: 1.2 });
          const canvas = document.createElement('canvas');
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;

          const img = document.createElement('img');
          img.src = canvas.toDataURL('image/jpeg', 0.9);
          img.style.width = '100%';
          img.style.height = 'auto';

          const div = document.createElement('div');
          div.className = 'page';
          div.setAttribute('data-page', num);
          div.appendChild(img);
          return div;
        }

        // Pre-render first 2 pages before init
        const p1 = await renderPage(1);
        flipbookEl.append(p1);
        if (total >= 2) {
          const p2 = await renderPage(2);
          flipbookEl.append(p2);
        }

        // Init Turn.js with spreads
        const firstImg = flipbookEl.find('img')[0];
        const flipW = Math.min(window.innerWidth*0.88, firstImg.naturalWidth*2*0.9);
        const flipH = Math.min(window.innerHeight*0.82, firstImg.naturalHeight*0.95);

        flipbookEl.turn({
          width: flipW,
          height: flipH,
          display: 'double',
          autoCenter: true,
          pages: total,
          elevation: 50,
          duration: 500
        });

        // Add placeholders
        for (let i=3; i<=total; i++) {
          const ph = document.createElement('div');
          ph.className = 'page';
          ph.setAttribute('data-page', i);
          ph.textContent = '…';
          flipbookEl.turn('addPage', ph, i);
        }

        // Lazy-load neighbors
        async function ensurePage(p) {
          if (p<1 || p>total) return;
          const div = flipbookEl.find(`[data-page='${p}']`)[0];
          if (!div || (div.firstChild && div.firstChild.tagName==='IMG')) return;
          const ready = await renderPage(p);
          div.textContent = '';
          div.appendChild(ready.firstChild);
        }

        flipbookEl.bind('turned', (e, p) => {
          $('#pageNum').val(p);
          [p-2,p-1,p,p+1,p+2].forEach(ensurePage);
        });
        ensurePage(3); ensurePage(4);

        // Controls
        $('#prev').on('click', () => flipbookEl.turn('previous'));
        $('#next').on('click', () => flipbookEl.turn('next'));
        $('#pageNum').attr('max', total);
        $('#pageNum').on('change', function(){
          const p = Math.max(1, Math.min(total, +this.value||1));
          flipbookEl.turn('page', p);
        });

        function applyZoom() {
          flipbookEl.find('img').each(function(){
            this.style.transformOrigin='top left';
            this.style.transform='scale('+currentZoom+')';
          });
        }
        $('#zoomIn').on('click', () => { currentZoom=Math.min(2.5, currentZoom+0.2); applyZoom(); });
        $('#zoomOut').on('click', () => { currentZoom=Math.max(0.6, currentZoom-0.2); applyZoom(); });

        document.getElementById('message').textContent = '';
      } catch(err) {
        console.error(err);
        document.getElementById('message').textContent = 'Error loading flipbook.';
      }
    })();
  </script>
</body>
</html>
