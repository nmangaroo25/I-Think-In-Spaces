<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Norris Mangaroo — Portfolio (Flipbook)</title>
  <style>
    :root{--bg:#0f1720;--card:#fff;--muted:#8892a6}
    html,body{height:100%;margin:0;font-family:Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:#fff}
    a.back {position:fixed;left:18px;top:18px;background:#fff;color:#111;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:600;z-index:9999}
    .topbar{position:fixed;right:18px;top:18px;display:flex;gap:8px;align-items:center;z-index:9999}
    .btn{background:#fff;color:#111;border:none;padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    .pager{display:flex;gap:6px;align-items:center;background:rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px}
    #flipbook-wrap{height:100vh;display:flex;align-items:center;justify-content:center;padding:64px 24px;box-sizing:border-box}
    #flipbook{box-shadow:0 10px 30px rgba(2,6,23,0.7);background:transparent}
    .page{background:var(--card);overflow:hidden;display:flex;align-items:center;justify-content:center}
    #message{position:fixed;left:18px;bottom:18px;background:rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <a class="back" href="https://nmangaroo25.github.io/I-Think-In-Spaces/#home">← Back to Home</a>

  <div class="topbar" role="toolbar" aria-label="Flipbook controls">
    <div class="pager" title="Navigation">
      <button id="prev" class="btn" aria-label="Previous page">‹</button>
      <input id="pageNum" type="number" min="1" value="1" style="width:64px;padding:6px;border-radius:6px;border:none;font-weight:700" />
      <span id="pageTotal" style="color:var(--muted);font-weight:600;padding-left:6px">/ 0</span>
      <button id="next" class="btn" aria-label="Next page">›</button>
    </div>

    <div style="width:10px"></div>
    <div class="pager" title="View">
      <button id="zoomOut" class="btn" aria-label="Zoom out">−</button>
      <button id="zoomIn" class="btn" aria-label="Zoom in">＋</button>
    </div>
  </div>

  <div id="flipbook-wrap">
    <div id="flipbook" aria-live="polite" role="application" aria-label="Portfolio flipbook"></div>
  </div>

  <div id="message">Loading portfolio…</div>

  <!-- jQuery, Turn.js, PDF.js -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <script>
    (async function(){
      const url = "Norris_Mangaroo_Arch_Portfolio.pdf"; // must match your filename
      const flipbookEl = $('#flipbook');
      let currentZoom = 1;

      if (!pdfjsLib) { document.getElementById('message').textContent = 'Error: pdf.js not loaded.'; return; }

      try {
        const pdf = await pdfjsLib.getDocument(url).promise;
        const total = pdf.numPages;
        $('#pageTotal').text('/ ' + total);

        // pre-render first 2 pages before init
        async function renderPage(num) {
          const page = await pdf.getPage(num);
          const viewport = page.getViewport({ scale: 1.2 });
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          await page.render({ canvasContext: ctx, viewport }).promise;

          const img = document.createElement('img');
          img.src = canvas.toDataURL('image/jpeg', 0.9);
          img.style.width = '100%';
          img.style.height = 'auto';

          const pageDiv = document.createElement('div');
          pageDiv.className = 'page';
          pageDiv.setAttribute('data-page', num);
          pageDiv.appendChild(img);
          return pageDiv;
        }

        // render first 2 pages
        const firstDiv = await renderPage(1);
        const secondDiv = (total >= 2) ? await renderPage(2) : null;

        flipbookEl.append(firstDiv);
        if (secondDiv) flipbookEl.append(secondDiv);

        // init turn.js with double-page mode
        const flipW = Math.min(window.innerWidth * 0.88, firstDiv.firstChild.naturalWidth * 2 * 0.9);
        const flipH = Math.min(window.innerHeight * 0.82, firstDiv.firstChild.naturalHeight * 0.95);

        flipbookEl.turn({
          width: flipW,
          height: flipH,
          autoCenter: true,
          display: 'double',
          elevation: 50,
          duration: 500,
          pages: total
        });

        // placeholder pages for rest
        for (let i = 3; i <= total; i++) {
          const pageDiv = document.createElement('div');
          pageDiv.className = 'page';
          pageDiv.setAttribute('data-page', i);
          pageDiv.textContent = 'Loading…';
          flipbookEl.turn('addPage', pageDiv, i);
        }

        // lazy load on demand
        async function ensureRendered(p) {
          if (p < 1 || p > total) return;
          const div = flipbookEl.find(`[data-page='${p}']`)[0];
          if (!div || div.hasChildNodes()) return;
          const newDiv = await renderPage(p);
          div.textContent = '';
          div.appendChild(newDiv.firstChild);
        }

        flipbookEl.bind('turned', (e, page) => {
          $('#pageNum').val(page);
          [page-2,page-1,page,page+1,page+2].forEach(ensureRendered);
        });

        // preload first neighbors
        ensureRendered(3);
        ensureRendered(4);

        // controls
        $('#prev').on('click', () => flipbookEl.turn('previous'));
        $('#next').on('click', () => flipbookEl.turn('next'));
        $('#pageNum').attr('max', total);
        $('#pageNum').on('change', function(){ const p = Math.max(1, Math.min(total, Number(this.value)||1)); flipbookEl.turn('page', p); });

        function applyZoom() {
          flipbookEl.find('img').each(function(){ this.style.transformOrigin='top left'; this.style.transform='scale('+currentZoom+')'; });
        }
        $('#zoomIn').on('click', () => { currentZoom = Math.min(2.5, +(currentZoom+0.15).toFixed(2)); applyZoom(); });
        $('#zoomOut').on('click', () => { currentZoom = Math.max(0.6, +(currentZoom-0.15).toFixed(2)); applyZoom(); });

        document.getElementById('message').textContent = '';
      } catch (err) {
        console.error(err);
        document.getElementById('message').textContent = 'Error loading flipbook.';
      }
    })();
  </script>
</body>
</html>
