<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Norris Mangaroo — Portfolio Flipbook</title>
<style>
  :root{
    --bg:#0f1720;
    --card:#fff;
    --muted:#8892a6;
  }
  html, body {
    height:100%;
    margin:0;
    font-family:Inter,Helvetica,Arial,sans-serif;
    background:var(--bg);
    color:#fff;
  }
  a.back {
    position:fixed;
    left:18px;
    top:18px;
    background:#fff;
    color:#111;
    padding:8px 12px;
    border-radius:8px;
    text-decoration:none;
    font-weight:600;
    z-index:9999;
  }
  .topbar {
    position:fixed;
    right:18px;
    top:18px;
    display:flex;
    gap:8px;
    align-items:center;
    z-index:9999;
  }
  .btn {
    background:#fff;
    color:#111;
    border:none;
    padding:8px 10px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
  }
  .pager {
    display:flex;
    gap:6px;
    align-items:center;
    background:rgba(255,255,255,0.04);
    padding:6px 8px;
    border-radius:8px;
  }
  #flipbook-wrap {
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:auto;
  }
  #flipbook {
    box-shadow:0 10px 30px rgba(2,6,23,0.7);
    background:transparent;
    transform-origin: top left;
  }
  .page {
    background:var(--card);
    display:inline-block;
    vertical-align:top;
  }
  #message {
    position:fixed;
    left:18px;
    bottom:18px;
    background:rgba(255,255,255,0.06);
    padding:8px 12px;
    border-radius:8px;
    color:var(--muted);
    font-size:13px;
    max-width:45%;
  }
</style>
</head>
<body>
<a class="back" href="https://nmangaroo25.github.io/I-Think-In-Spaces/#home">← Back to Home</a>

<div class="topbar" role="toolbar" aria-label="Flipbook controls">
  <div class="pager" title="Navigation">
    <button id="prev" class="btn" aria-label="Previous page">‹</button>
    <input id="pageNum" type="number" min="1" value="1" style="width:64px;padding:6px;border-radius:6px;border:none;font-weight:700">
    <span id="pageTotal" style="color:var(--muted);font-weight:600;padding-left:6px">/ 0</span>
    <button id="next" class="btn" aria-label="Next page">›</button>
  </div>
  <div style="width:10px"></div>
  <div class="pager" title="View">
    <button id="zoomOut" class="btn" aria-label="Zoom out">−</button>
    <button id="zoomIn" class="btn" aria-label="Zoom in">＋</button>
  </div>
</div>

<div id="flipbook-wrap">
  <div id="flipbook" aria-live="polite" role="application" aria-label="Portfolio flipbook"></div>
</div>

<div id="message">Loading flipbook — please wait…</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/0.11/turn.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

(async function(){
  const url = "Norris_Mangaroo_Arch_Portfolio.pdf";
  const flipbookEl = $('#flipbook');
  const pageCanvases = [];
  let currentZoom = 1;

  try{
    const pdf = await pdfjsLib.getDocument(url).promise;
    let total = pdf.numPages;
    $('#pageTotal').text('/ '+total);

    // Add blank first page if total is odd
    if(total % 2 !== 0){
      const blank = document.createElement('div');
      blank.className='page';
      flipbookEl.append(blank);
      total += 1;
    }

    // Render each PDF page as a single Turn.js page
    for(let i=1;i<=pdf.numPages;i++){
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({scale:1.5});
      const canvas = document.createElement('canvas');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise;

      const pageDiv = document.createElement('div');
      pageDiv.className='page';
      pageDiv.style.width = canvas.width+'px';
      pageDiv.style.height = canvas.height+'px';
      pageDiv.appendChild(canvas);
      flipbookEl.append(pageDiv);
    }

    const firstPage = flipbookEl.find('.page')[0];
    flipbookEl.turn({
      width:firstPage.scrollWidth*2, // double width for spread
      height:firstPage.scrollHeight,
      display:'double',
      autoCenter:true,
      elevation:50,
      duration:450
    });

    // Navigation
    $('#prev').on('click',()=>flipbookEl.turn('previous'));
    $('#next').on('click',()=>flipbookEl.turn('next'));
    $('#pageNum').attr('max',flipbookEl.turn('pages'));
    $('#pageNum').on('change',function(){
      const p = Math.max(1,Math.min(flipbookEl.turn('pages'),Number(this.value)||1));
      flipbookEl.turn('page',p);
    });
    flipbookEl.bind('turned',function(e,p){ $('#pageNum').val(p); });

    // Zoom
    function applyZoom(){ flipbookEl.css('transform','scale('+currentZoom+')'); }
    $('#zoomIn').on('click',()=>{ currentZoom=Math.min(2.5,(currentZoom+0.15).toFixed(2)); applyZoom(); });
    $('#zoomOut').on('click',()=>{ currentZoom=Math.max(0.6,(currentZoom-0.15).toFixed(2)); applyZoom(); });

    // Fit to screen
    function fitToScreen(){
      const winW = window.innerWidth*0.95;
      const winH = window.innerHeight*0.85;
      const first = flipbookEl.find('.page')[0];
      currentZoom = Math.min(winW/(first.scrollWidth*2), winH/first.scrollHeight);
      applyZoom();
    }
    $(window).on('resize',fitToScreen);
    fitToScreen();

    flipbookEl.turn('page',1);
    $('#message').text('Flipbook loaded — enjoy!');

  }catch(err){
    $('#message').text('Error rendering PDF/flipbook. See console.');
    console.error(err);
  }
})();
</script>
</body>
</html>
